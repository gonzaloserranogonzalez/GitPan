<html xmlns="http://www.w3.org/1999/html">
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<div id="myDIV">
  <section id="arriba">
    <nav class="navbar navbar-expand-sm bg-warning navbar-dark">
      <a class="navbar-brand" href="eleccionpanadero.html">PanAPP - Administración</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-555"
        aria-controls="navbarSupportedContent-555" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="#inventario" onclick="mostrarInventario();">Inventario</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#recaudacion" onclick="mostrarRecaudacion();">Recaudacion</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#agenda">Agenda reparto</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#clientes">Clientes</a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto nav-flex-icons">
        <li class="nav-item avatar">
          <a class="nav-link p-0" href="#">
            <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-5.jpg" class="rounded-circle z-depth-0"
              alt="avatar image" height="35">
          </a>
        </li>
      </ul>
    </nav>
</div>
</section>
<a class='flotante' href="#arriba" style="width:50px; padding-bottom:65px;"> <img
    style="display: scroll; position: fixed; bottom: 40px; top: auto; right: 15px; left: auto; height: auto; width: 20px"
    src="upscrollarrow.png"></img></a>
<img
  style="display: scroll; position: fixed; bottom: 20px; top: auto; right: 15px; left: auto; height: auto; width: 20px"
  src="downscrollarrow.png"></img></a>
<div class="container" id="contenedor">
  <table id='tablainventario' style="margin-top:20px"></table>
</div>
<link rel="stylesheet" href="panadero.css" />

</html>
<script type="text/javascript">
  var stock, productos, fotos, tabla, usuarios,arraypedidos;
  stock = JSON.parse(localStorage.getItem("stock"));
  //alert(stock);
  productos = JSON.parse(localStorage.getItem("productos"));
  fotos = JSON.parse(localStorage.getItem("imagenes"));
  usuarios = JSON.parse(localStorage.getItem("usuarios"));
    
   
  window.onload = function () {
      arrayPedidos=JSON.parse(localStorage.getItem("arrayPedidos"));
 console.log(arrayPedidos);
    // alert(usuarios);
    var URLactual = location.hash;
    switch (URLactual) {
      case "#inventario": mostrarInventario(); break;
      case "#recaudacion": mostrarRecaudacion(); break;
      case "#agenda":mostrarReparto();break;
      case "#clientes":
    }

  }

  function mostrarInventario() {

    var a = document.getElementById("contenedor");
    a.innerHTML = "<table id='tablainventario' style='margin-top:20px;'></table>";
    tabla = document.getElementById('tablainventario');
    var fila = tabla.insertRow(-1);
    fila.className = "filainventario";
    var columnainicial = fila.insertCell(-1);
    columnainicial.className = "tablainicial";
    columnainicial.innerHTML = "Nombre de producto &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspStock&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp¿Cuantos productos quiere añadir al stock? ";


    for (var i = 0; i < stock.length; i++) {
      var fila = tabla.insertRow(-1);
      fila.className = "filainventario"
      var columna = fila.insertCell(-1);
      columna.innerHTML = "<img src=" + fotos[i] + " style='margin-top:15px;' class='rounded-rectangle z-depth-0' alt='avatar image' height='100'>";
      columna = fila.insertCell(-1);
      columna.innerHTML += "<br><p style:'padding-left:20px; font-family:Montserrat'>" + productos[i] + "</p>";
      columna = fila.insertCell(-1);
      columna.id = "stock" + i;
      document.getElementById('stock' + i).style.paddingLeft = "35px";
      columna.innerHTML += "<br><p> El stock es: " + stock[i] + "</p>";
      columna = fila.insertCell(-1);
      columna.id = "anadirstock" + i;
      document.getElementById('anadirstock' + i).style.paddingLeft = "35px";
      columna.innerHTML += "<input type='number' min='1' id='modificarstock" + i + "'></input><button type='button' onclick='actualizarstock(" + i + ");'>Confirmar</button> ";



    }


  }
  function actualizarstock(i) {
    var sumar = document.getElementById("stock" + i);
    var suma = document.getElementById("modificarstock" + i);
    if (parseInt(stock[i]) + parseInt(suma.value) > 0) {
      var total = parseInt(stock[i]) + parseInt(suma.value);
      //alert(total);

      sumar.innerHTML = "<p> El stock es: " + total;
      suma.value = null;
      stock[i] = total;
    }
    else {
      sumar.innerHTML = "<p> El stock es: 0";
      suma.value = null;
      stock[i] = 0;
    }


  }

  function mostrarRecaudacion() {

    var a = document.getElementById("contenedor");
    a.innerHTML = "<br><h2>Seleccione el usuario sobre el cual quiere ver información:<br></h2>";
    for (var i = 1; i < usuarios.length; i++) {
      a.innerHTML += "<br><a href='#' id='" + usuarios[i] + "' onclick='mostrarcompracliente(this.id);return false;' class='nombre'>" + usuarios[i] + "</a>";
            var numpedidos = 0;
      for (var j = 0; arrayPedidos[i][j]!=null; j++) {

            numpedidos = numpedidos + 1;

      }
      a.innerHTML += "<br><a  class='numpedidos'>       Numero de pedidos del usuario: " + numpedidos + "<br></a>";

    }

  }

  function mostrarcompracliente(login) {
    var a = document.getElementById("contenedor");
    var comprausuario = 0;
    //console.log(arrayPedidos[0][0][0][productos[6]].nombre);
    a.innerHTML = "<br><br> Usuario: " + login;
    var i = 0;
    for (; i < usuarios.length && usuarios[i] != login; i++);
    for (var j = 0; arrayPedidos[i][j] != null; j++) {
      var precioporpedido = 0;
      a.innerHTML += "<br>Pedido numero " + j + ":<br>";
      console.log(arrayPedidos[i][j][0]);
      for (var z = 0; z < productos.length; z++) {
        if (arrayPedidos[i][j][0][productos[z]] != null) {
          a.innerHTML += "Producto: " + arrayPedidos[i][j][0][productos[z]].nombre;
          a.innerHTML += "   Cantidad: " + arrayPedidos[i][j][0][productos[z]].cantidad;
          a.innerHTML += "   Precio del producto: " + arrayPedidos[i][j][0][productos[z]].precioproducto;
          a.innerHTML += "   Precio total por producto: " + arrayPedidos[i][j][0][productos[z]].precioporcantidad + "<br>";
          precioporpedido += arrayPedidos[i][j][0][productos[z]].precioporcantidad;
        }
      }
      a.innerHTML += "Precio total pedido " + j + ": " + precioporpedido + "<br>";
      comprausuario += precioporpedido;
    }
    a.innerHTML += "<br><br> El usuario " + usuarios[i] + " ha aportado a PanAPP: " + comprausuario;
  }
  // Highlight a la pestaña de navbar en la que nos encontramos
  var header = document.getElementById("myDIV");
  var btns = header.getElementsByClassName("nav-item");
  for (var i = 0; i < btns.length; i++) {
    btns[i].addEventListener("click", function () {
      var current = document.getElementsByClassName("active");
      current[0].className = current[0].className.replace(" active", "");
      this.className += " active";
    });
  }

    
    function mostrarReparto(){
        
         var a = document.getElementById("contenedor");
        var diasSemana=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"];
        var f=new Date();
        a.innerHTML="<br><h1>Seleccione el dia de la semana en el cual va a repartir:</h1>";
        a.innerHTML+="<br>Dia actual: "+diasSemana[f.getDay()];
        a.innerHTML+="<br><select name='OS' id='dias' style='width:30%'><option value='Lunes'>Lunes</option> <option value='Martes'>Martes</option> <option value='Miercoles'>Miercoles</option><option value='Jueves'>Jueves</option> <option value='Viernes'>Viernes</option> <option value='Sabado'>Sabado</option> </select>";
        a.innerHTML+="<input type='button' value='Comprobar Envíos' onclick='mostrarRepartocondia();'></input>";
        
    }
    
    
    function mostrarRepartocondia(){
        var a = document.getElementById("contenedor");
        var dia=document.getElementById("dias");
        var semana=new Array();
        dia=(dia.options[dia.selectedIndex].value);
       // alert(typeof(dia));
        a.innerHTML="<br><h1>Pedidos de PanAPP para el día "+dia+":<br></h1>";
        for(var i=1;i<usuarios.length;i++){
           for(var j=0;j < arrayPedidos[i][j]!=null;j++){
                       var z=0;
                for(z ;z<productos.length && arrayPedidos[i][j][0][productos[z]]==null;z++);
                if(arrayPedidos[i][j][0][productos[z]].dia!=undefined ){
                    semana=arrayPedidos[i][j][0][productos[z]].dia.split(" ",6);
                    for(var w=0;w<semana.length;w++){
                        if(semana[w]==dia){
                            a.innerHTML+="<br><h3>Pedido del usuario "+usuarios[i]+" :</h4>";
                            for(var p=0;p<productos.length ;p++){
                                if(arrayPedidos[i][j][0][productos[p]]!=null){
                                    a.innerHTML+="<br>Producto: "+ arrayPedidos[i][j][0][productos[p]].nombre;
                                    a.innerHTML+=". Cantidad de "+productos[p]+": "+arrayPedidos[i][j][0][productos[p]].cantidad;
                                }
                            }
                        }
                    }
                }
            }
            
        }
         
        
    }


</script>



<SCRIPT>

  var arrayPedidos = new Array(6);
  for (var i = 0; i < arrayPedidos.length; i++) {
    arrayPedidos[i] = new Array(2);
  }

 

  for (var i = 0; i < 6; i++) {
    for (var j = 0; j < 2; j++) {
      console.log("Array de pedidos:[" + i + "][" + j + "]:", arrayPedidos[i][j]);
    }
  }





</SCRIPT>