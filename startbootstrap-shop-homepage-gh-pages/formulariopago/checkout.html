<!DOCTYPE html>
<html lang="en">

<head>
    <title>Checkout - One Step Checkout</title>
    <!-- Required meta tags always come first -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator"
        content="Checkout - One Step Checkout , Responsive Bootstrap 4 template , bootstrap 4 starter template, bootstrap4 template, checkout template">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" lang="en"
        content="Checkout Bootstrap 4 pricing template , Responsive and Modern HTML5 Template made from bootstrap 4.">
    <meta name="keywords" lang="en"
        content="pricing template, bootstrap 4 template,bootstrap 4 checkout template, responsive bootstrap 4 template, bootstrap 4, bootstraping, bootstrap4, oribitthemes">
    <meta name="robots" content="index, follow">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <meta name="description" content="">
    <!--Font Awesome-->
    <link rel="stylesheet" href="dist/font-awesome/css/font-awesome.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="css/main.min.css">
    <!--[if IE]>
      <link href="https://cdn.jsdelivr.net/gh/coliff/bootstrap-ie8/css/bootstrap-ie9.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/g/html5shiv@3.7.3"></script>
    <![endif]-->
    <!--[if lt IE 9]>
      <link href="https://cdn.jsdelivr.net/gh/coliff/bootstrap-ie8/css/bootstrap-ie8.min.css" rel="stylesheet">
    <![endif]-->

</head>

<body>
    <div class="loader"></div>
    <main id="main" role="main">
        <section id="checkout-container">
            <div class="container">
                <div class="py-5 text-center">
                    <i class="fa fa-credit-card fa-3x text-primary"></i>
                    <h2 class="my-3">Confirma tu pedido</h2>
                    <p class="lead">Para poder finalizar tu pedido introduce tus datos bancarios y elige el tipo de
                        entrega que deseas.</p>
                </div>
                <div class="row py-5">
                    <div class="col-md-4 order-md-2 mb-4" id=factura>
                        <h4 class="d-flex justify-content-between align-items-center mb-3" >
                            <span class="text-muted">Tu pedido</span>
                            <span class="badge badge-secondary badge-pill" , id=numproductos></span>
                        </h4>
                        <ul class="list-group mb-3" id="carritoderecha">
                    </div>
                    <div class="col-md-8 order-md-1">
                        <form class="needs-validation" novalidate>
                            <hr class="mb-4">

                            <h4 class="mb-3"><img src="img/shipping.png" width="40" height="40"> Forma de entrega</h4>

                            <div class="d-block my-3">
                                <div class="custom-control custom-radio">
                                    <input id="tienda" name="shippingMethod" type="radio" onclick="hideDiv('Recogida en tienda')"
                                        class="custom-control-input" checked required>
                                    <label class="custom-control-label" for="tienda">Recogida en tienda<p font=" small-caption;" id="textotienda"></p></label>
                                </div>
                                <div class="custom-control custom-radio">
                                    <input id="unico" name="shippingMethod" type="radio" onclick="hideDiv('Envío único')"
                                        class="custom-control-input" required>
                                    <label class="custom-control-label" for="unico">Envío único<p font=" small-caption;" id="textoenvio"></p></label>
                                </div>
                                <div class="custom-control custom-radio">
                                    <input id="reparto" name="shippingMethod" type="radio" value="Show Div"
                                        onclick="showDiv('Reparto diario')" class="custom-control-input" required>
                                    <label class="custom-control-label" for="reparto">Reparto diario<p font=" small-caption;" id="textoreparto"></p></label>
                                    <div id="dias" style="display:none;" class="answer_list">
                                        <form id="diasform">
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Lunes">Lunes
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Martes">Martes
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Miercoles">Miercoles
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Jueves">Jueves
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Viernes">Viernes
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Sabado">Sabado
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" class="checks" value="Domingo">Domingo
                                            </label>
                                        </form>
                                        <input type='button' onclick='window.countdays();' value='Confirmar selección'/>
                                    </div>
                                </div>
                            </div>
                            <hr class="mb-4">

                            <h4 class="mb-3"><img src="img/payment.png" width="40" height="40"> Forma de pago</h4>

                            <div class="d-block my-3">
                                <div class="custom-control custom-radio">
                                    <input id="credit" name="paymentMethod" type="radio" class="custom-control-input"
                                        checked required onclick="tipopagofuncion('Tarjeta de crédito')">
                                    <label class="custom-control-label" for="credit">Tarjeta de crédito <img
                                            src="img/credit.png" width="184" height="35"></label>
                                </div>
                                <div class="custom-control custom-radio">
                                    <input id="paypal" name="paymentMethod" type="radio" class="custom-control-input"
                                        required onclick="tipopagofuncion('PayPal')">
                                    <label class="custom-control-label" for="paypal"><img src="img/paypal.png"
                                            width="80" height="80"></label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cc-name">Nombre que figura en la tarjeta</label>
                                    <input type="text" class="form-control" id="cc-name" placeholder="" required>
                                    <div class="invalid-feedback">
                                        El nombre en la tarjeta es necesario
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cc-number">Número de la tarjeta</label>
                                    <input type="text" class="form-control" id="cc-number" placeholder="" required>
                                    <div class="invalid-feedback">
                                        Numero de la tarjeta necesario
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="cc-expiration">Fecha de vencimiento</label>
                                    <input type="text" class="form-control" id="cc-expiration" placeholder="" required>
                                    <div class="invalid-feedback">
                                        Fecha de vencimiento necesario
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="cc-expiration">CVV</label>
                                    <input type="text" class="form-control" id="cc-cvv" placeholder="" required>
                                    <div class="invalid-feedback">
                                        Codigo de seguridad necesario
                                    </div>
                                </div>
                            </div>
                            <hr class="mb-4">
                            <button class="btn btn-primary btn-lg btn-block" type="submit" onclick="printbill()">Finalizar pedido</button>
                        </form>
                    </div>
                </div>
            </div>
            <a href="#" class="btn btn-primary scrollUp">
                <i class="fa fa-arrow-circle-o-up"></i>
            </a>
        </section>
    </main>
    <!-- jQuery first, then Bootstrap JS. -->
    <script src="dist/jquery/jquery.min.js"></script>
    <script src="dist/popper/popper.min.js" integrity=""></script>
    <script src="dist/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/main.min.js"></script>
    <script>
        var productos = ["Barra Rustica", "Barra de picos", "Chapata", "Torta de Aranda", "Baguette", "Tarta de Santiago", "Tarta de tres chocolates", "Tarta Red Velvet", "Tarta de zanahoria", "Tarta de queso", "Empanada de atun", "Empanada de pollo", "Empanada de jamon y queso", "Empanada vegana", "Empanada de bacalao"];
        var costecarrito = localStorage.getItem("costecarrito");
        var numproductos = localStorage.getItem("numproductos");
        document.getElementById("numproductos").innerHTML = numproductos;
        var carrito = JSON.parse(localStorage.getItem("carrito"));
        var bdusuarios=JSON.parse(localStorage.getItem("usuarios"));
        var tipopago="Tarjeta de credito";
        var tipoentrega="Recogida en tienda";
        var dias=",\"dias\":";
        var tipopedido = localStorage.getItem("tipopedido");
        for (var x = 0; x < productos.length; x++) {
            if (carrito[0][productos[x]]) {
                //console.log(carrito[0][productos[x]].nombre);
                //console.log(carrito[0][productos[x]].cantidad);
                //console.log(carrito[0][productos[x]].precioporcantidad);
                document.getElementById("carritoderecha").innerHTML += " <li class='list-group-item d-flex justify-content-between lh-condensed'><div><h6 class='my-0'>" + carrito[0][productos[x]].nombre + "</h6><small class='text-muted'>" + "Cantidad: " + carrito[0][productos[x]].cantidad + "</small></div><span class='text-muted'>" + carrito[0][productos[x]].precioporcantidad + "€" + "</span></li>"

            }
        }
        document.getElementById("carritoderecha").innerHTML += "<li class='list-group-item d-flex justify-content-between' id='preciofinal'><span id='idtotal'>Total</span><strong>" + costecarrito + "€" + "</strong></li>"
        function showDiv(tipo) {
            document.getElementById('dias').style.display = "block";
            tipoentrega=tipo;

        }
        function hideDiv(tipo) {
            tipoentrega=tipo;
            document.getElementById('dias').style.display = "none";
            document.getElementById("carritoderecha").innerHTML ="";
            for (var x = 0; x < productos.length; x++) {
            if (carrito[0][productos[x]]) {
                console.log(carrito[0][productos[x]].nombre);
                console.log(carrito[0][productos[x]].cantidad);
                console.log(carrito[0][productos[x]].precioporcantidad);
                document.getElementById("carritoderecha").innerHTML += " <li class='list-group-item d-flex justify-content-between lh-condensed'><div><h6 class='my-0'>" + carrito[0][productos[x]].nombre + "</h6><small class='text-muted'>" + "Cantidad: " + carrito[0][productos[x]].cantidad + "</small></div><span class='text-muted'>" + carrito[0][productos[x]].precioporcantidad + "€" + "</span></li>"

            }
        }
        document.getElementById("carritoderecha").innerHTML += "<li class='list-group-item d-flex justify-content-between' id='preciofinal'><span id='idtotal'>Total</span><strong>" + costecarrito + "€" + "</strong></li>"
        }
            if(tipopedido == "Productos del dia"){
                document.getElementById("textotienda").innerHTML ="Tus productos están preparados. Ven a recogerlo a nuestra tienda en cualquier momento";
                document.getElementById("textoenvio").innerHTML ="Recibirás tu pedido mañana en la dirección asociada a tu cuenta";
                document.getElementById("textoreparto").innerHTML ="Indica los días de la semana que deseas recibir el pedido en la dirección asociada a tu cuenta";
            }
            else{
                document.getElementById("textotienda").innerHTML ="Tus productos estarán preparados a partir de mañana.<br> Puedes venir a recogerlo a nuestra tienda <strong>mañana a partir de las 10:00</strong>";
                document.getElementById("textoenvio").innerHTML ="Recibirás tu pedido <strong>dentro de dos días</strong> en la dirección asociada a tu cuenta";
                document.getElementById("textoreparto").innerHTML ="Indica los días de la semana que deseas recibir el pedido en la dirección asociada a tu cuenta.<br>Al ser un pedido de encargo, el inicio del servicio de reparto comenzará <strong>dentro de dos días</strong>";
            }
        function tipopagofuncion(tipo){
            tipopago=tipo;
        }

        function countdays(){
            var checks = document.getElementsByClassName('checks');
            var days = "\"";
            tipoentrega=" Reparto semanal los dias: ";
            for(var i=0;i<7;i++){
                if(checks[i].checked===true){
                    tipoentrega += checks[i].value + " ";
                    days += checks[i].value + " ";
                }
            }    
            days += "\"";
            dias += days;
            var diasencargo=document.querySelectorAll('input[type="checkbox"]:checked').length;
            if(document.getElementById('semanal') ==null){
            document.getElementById("idtotal").innerHTML += " diario";
            document.getElementById("carritoderecha").innerHTML += "<li class='list-group-item d-flex justify-content-between' id='semanal'><span id='idtotalsemanal'>Total semanal</span><strong id=costexdias>" + costecarrito*diasencargo + "€" + "</strong></li>"
            }
            else{
                document.getElementById("costexdias").innerHTML = costecarrito*diasencargo + "€" ;
            }
        }
        function adddays(stringbuscar, dias){
            var n = stringbuscar.search(",");
            console.log("Posicion de la coma",n);

            var output = stringbuscar.substr(0, n) + dias + stringbuscar.substr(n);
            console.log("Nueva salida:", output)
            return output;
        }
        function printbill(){
            var usuarioactual=localStorage.getItem("usuarioactual");
            var pedidodiario=localStorage.getItem("carrito");
            if(tipoentrega != "Recogida en tienda" && tipoentrega != "Envío único"){
            console.log("OK");
            carrito=JSON.parse(adddays(pedidodiario, dias));
            }
            //pedidoprueba=JSON.parse(pedidoprueba);
            console.log("Usuario actual",usuarioactual);
            var arrayPedidos = JSON.parse(localStorage.getItem("arrayPedidos"));
            //arrayPedidos[0][0]="Usuario 0 Pedido 1";
            //arrayPedidos[0][1]="Usuario 0 Pedido 2";
            //arrayPedidos[1][0]="Usuario 1 Pedido 1";
            //arrayPedidos[3][1]=pedidoprueba;
            //alert(localStorage.getItem("carrito"));
            for (var j = 0; j < 10; j++) {
            if(arrayPedidos[usuarioactual][j] === null){
                //console.log("i:", i, "j:", j);
                arrayPedidos[usuarioactual][j]=carrito;
                localStorage.setItem("arrayPedidos", JSON.stringify(arrayPedidos));
                break;
                }
            }
            for(var i=0; i<10;i++){
                for(var j=0;j<4;j++){
                console.log("arrayBidimensional["+i+"]["+j+"]:",arrayPedidos[i][j]);
                }
            } 
            var factura=document.getElementById("factura").innerHTML;
            var nFactura=Math.floor(Math.random() * 10000000)+100000;
            document.body.innerHTML= "<html><body><br><div class='col-md-4 order-md-2 mb-4'><p style='font-size:160%;'>Tú pedido se ha realizado con éxito<br>Ticket #"+nFactura+"</p>"+factura+"<br><p>"+"Cliente: "+ bdusuarios[usuarioactual]+"<br>"+"Tipo de pedido: "+ tipopedido +"<br>"+"Tipo de entrega: "+ tipoentrega +"<br>"+"Tipo de pago: "+ tipopago+ "</p><br><input type='button' onclick='window.print();' value='Imprimir factura'/></div></body></html>";
            document.body.innerHTML+="<br><a href='../login.html'>hola</a>"
            //window.print();
        }
    </script>
</body>

</html>